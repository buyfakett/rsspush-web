"use strict";(self["webpackChunkrsspush"]=self["webpackChunkrsspush"]||[]).push([[470],{3470:function(t,e,s){s.r(e),s.d(e,{default:function(){return F}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"add"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.add_rss()}}},[t._v("新增")]),e("el-button",{attrs:{type:"warning"},on:{click:function(e){return t.refresh_push()}}},[t._v("刷新push")])],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""}},[e("el-table-column",{attrs:{prop:"id",label:"id",width:"60px"}}),e("el-table-column",{attrs:{prop:"rss_uri",label:"rss地址",width:"center"}}),e("el-table-column",{attrs:{prop:"timestamp_text",label:"最后更新时间",width:"center"}}),e("el-table-column",{attrs:{prop:"detection_time_text",label:"检查时间",width:"center"}}),e("el-table-column",{attrs:{width:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(e){return t.edit_rss(s.row)}}},[t._v("修改rss地址")]),e("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(e){return t.is_delete_rss(s.row.id)}}},[t._v("删除")]),e("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(e){return t.edit_push(s.row)}}},[t._v("修改推送")])]}}])})],1),e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":t.pageSizeList,"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),e("el-dialog",{attrs:{title:t.rss_title_state?"添加rss地址":"修改rss地址",visible:t.rssFormVisible},on:{"update:visible":function(e){t.rssFormVisible=e}}},[e("el-form",{attrs:{model:t.rssForm}},[e("el-form-item",{attrs:{label:"rss地址：","label-width":"80px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.rssForm.rss_uri,callback:function(e){t.$set(t.rssForm,"rss_uri",e)},expression:"rssForm.rss_uri"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.rss_button(t.rssForm)}}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"修改推送方式",visible:t.pushFormVisible},on:{"update:visible":function(e){t.pushFormVisible=e}}},[e("el-form",{attrs:{model:t.pushForm}},[e("el-form-item",{attrs:{label:"推送方式：","label-width":"200px"}},[e("el-select",{staticClass:"choosePushType",attrs:{placeholder:"请选择"},model:{value:t.pushForm.push_type,callback:function(e){t.$set(t.pushForm,"push_type",e)},expression:"pushForm.push_type"}},t._l(t.options,(function(t){return e("el-option",{key:t.push_type,attrs:{label:t.label,value:t.push_type}})})),1)],1),t.shouWX?e("el-form-item",{attrs:{label:"微信模板id：","label-width":"200px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.pushForm.wechat_template_id,callback:function(e){t.$set(t.pushForm,"wechat_template_id",e)},expression:"pushForm.wechat_template_id"}})],1):t._e(),t.shouWX?e("el-form-item",{attrs:{label:"微信appId：","label-width":"200px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.pushForm.wechat_app_id,callback:function(e){t.$set(t.pushForm,"wechat_app_id",e)},expression:"pushForm.wechat_app_id"}})],1):t._e(),t.shouWX?e("el-form-item",{attrs:{label:"推送给的用户们：","label-width":"200px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.pushForm.wechat_to_user_ids,callback:function(e){t.$set(t.pushForm,"wechat_to_user_ids",e)},expression:"pushForm.wechat_to_user_ids"}})],1):t._e(),t.shouDing?e("el-form-item",{attrs:{label:"钉钉access_token：","label-width":"200px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.pushForm.ding_access_token,callback:function(e){t.$set(t.pushForm,"ding_access_token",e)},expression:"pushForm.ding_access_token"}})],1):t._e(),t.shouDing?e("el-form-item",{attrs:{label:"钉钉推送关键字：","label-width":"200px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.pushForm.ding_keyword,callback:function(e){t.$set(t.pushForm,"ding_keyword",e)},expression:"pushForm.ding_keyword"}})],1):t._e(),e("el-form-item",{attrs:{label:"检测间隔时间：","label-width":"200px"}},[e("el-input",{attrs:{autocomplete:"off"},model:{value:t.pushForm.detection_time,callback:function(e){t.$set(t.pushForm,"detection_time",e)},expression:"pushForm.detection_time"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.push_button(t.pushForm)}}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"确定删除吗？",visible:t.deleteVisible,width:"30%"},on:{"update:visible":function(e){t.deleteVisible=e}}},[e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.delete_rss()}}},[t._v("确 定")])],1)])],1)},r=[],a=s(2996),o=s.n(a),l=s(6659);function h(t){return(0,l.Z)({method:"GET",url:"/rss/list",params:t})}function n(t){return(0,l.Z)({method:"DELETE",url:"/rss/delete",data:t})}function u(t,e){let s="";return"POST"===t?s="/rss/add":"PUT"===t&&(s="/rss/edit"),(0,l.Z)({method:t,url:s,data:e})}s(7658);const p=(t,e="Y-m-d H:i:s")=>{if(!t)return"";t=10===t.toString().length?1e3*+t:+t;let s=new Date(t),i=s.getFullYear(),r=s.getMonth()+1,a=s.getDate(),o=s.getHours(),l=s.getMinutes(),h=s.getSeconds();return r=r<10?"0"+r:r,a=a<10?"0"+a:a,o=o<10?"0"+o:o,l=l<10?"0"+l:l,h=h<10?"0"+h:h,e.replace(/[YmdHis]/g,(t=>({Y:i,m:r,d:a,H:o,i:l,s:h}[t])))};function d(){return(0,l.Z)({method:"GET",url:"/push/refresh"})}function _(t){return(0,l.Z)({method:"GET",url:"/push/view",params:t})}function c(t){return(0,l.Z)({method:"PUT",url:"/push/edit",data:t})}function m(t){return(0,l.Z)({method:"POST",url:"/push/add",data:t})}var b={data(){return{tableData:[],currentPage:1,pageSize:5,pageSizeList:[5,10,20,30,40],total:0,params:{},rssFormVisible:!1,pushFormVisible:!1,rssForm:{rss_uri:""},pushForm:{push_type:"",ding_access_token:"",ding_keyword:"",wechat_app_id:"",wechat_template_id:"",wechat_to_user_ids:"",detection_time:""},rss_title_state:!0,options:[{push_type:"wechat",label:"微信测试号"},{push_type:"ding",label:"钉钉"}],push_type:"",shouWX:!1,shouDing:!1,push_id:"",rss_id:"",detection_push:!1,deleteVisible:!1,delete_id:""}},watch:{"pushForm.push_type"(t){"wechat"===t?(this.shouWX=!0,this.shouDing=!1):"ding"===t&&(this.shouDing=!0,this.shouWX=!1)}},methods:{is_delete_rss(t){this.deleteVisible=!0,this.delete_id=t},handleSizeChange(t){this.pageSize=t,this.params.pageSize=t,this.getList(this.params)},handleCurrentChange(t){this.currentPage=t,this.params.page=t,this.getList(this.params)},getList(t){h(t).then((t=>{0===t.code&&(this.total=t.count,this.tableData=t.data,this.tableData.forEach((t=>{null===t.detection_time?t.detection_time_text="":t.detection_time_text=t.detection_time+"m",null===t.timestamp?t.timestamp_text="":t.timestamp_text=p(t.timestamp,"Y-m-d H:i:s")})))}))},refresh_push(){d().then((t=>{0===t.code&&this.getList(this.params)}))},delete_rss(){let t={id:this.delete_id};n(t).then((t=>{0===t.code&&(this.getList(this.params),this.deleteVisible=!1,this.delete_id="")}))},edit_rss(t){this.rss_title_state=!1,this.rssForm={...t},this.rssFormVisible=!0},add_rss(){this.rss_title_state=!0,this.rssForm.rss_uri="",this.rssFormVisible=!0},rss_button(t){u(this.rss_title_state?"POST":"PUT",t).then((t=>{0===t.code&&(this.rssFormVisible=!1,this.getList(this.params))}))},push_button(t){this.detection=!1,t.id="",""===t.push_type?o().error({message:"参数缺少",type:"error"}):"ding"===t.push_type?""===t.ding_access_token||""===t.ding_keyword?o().error({message:"参数缺少",type:"error"}):this.detection=!0:"wechat"===t.push_type&&(""===t.wechat_app_id||""===t.wechat_template_id||""===t.wechat_to_user_ids?o().error({message:"参数缺少",type:"error"}):this.detection=!0),this.detection&&(""!==this.push_id?(t.id=this.push_id,c(t).then((t=>{0===t.code&&(this.pushFormVisible=!1,this.getList(this.params))}))):(t.rss_id=this.rss_id,m(t).then((t=>{0===t.code&&(this.pushFormVisible=!1,this.getList(this.params))}))))},edit_push(t){if(this.push_id="",this.pushForm.wechat_app_id="",this.pushForm.push_type="",this.pushForm.wechat_template_id="",this.pushForm.wechat_to_user_ids="",this.pushForm.ding_access_token="",this.pushForm.ding_keyword="",this.shouDing=!1,this.shouWX=!1,this.pushFormVisible=!0,this.rss_id=t.id,null!==t.push_id||""!==t.push_id){let e={rss_id:t.id};_(e).then((t=>{0===t.code&&("wechat"===t.data.push_type?(this.shouWX=!0,this.pushForm.push_type=t.data.push_type,this.pushForm.wechat_app_id=t.data.wechat_app_id,this.pushForm.wechat_template_id=t.data.wechat_template_id,this.pushForm.wechat_to_user_ids=t.data.wechat_to_user_ids):"ding"===t.data.push_type&&(this.shouDing=!0,this.pushForm.push_type=t.data.push_type,this.pushForm.ding_access_token=t.data.ding_access_token,this.pushForm.ding_keyword=t.data.ding_keyword),this.pushForm.detection_time=t.data.detection_time,this.push_id=t.data.id)}))}}},created(){this.params.pageSize=this.pageSize,this.params.page=this.currentPage,this.getList(this.params)}},g=b,f=s(1001),w=(0,f.Z)(g,i,r,!1,null,null,null),F=w.exports}}]);
//# sourceMappingURL=470.aa4e00c8.js.map